plugins {
    id 'java'
    id 'application'
    id 'idea'
}

group = 'javanaise'
version = '2.0.0'

java {
    sourceCompatibility = JavaVersion.VERSION_21
    targetCompatibility = JavaVersion.VERSION_21
}

repositories {
    mavenCentral()
}

sourceSets {
    main {
        java {
            srcDirs = ['src']
        }
    }
}

dependencies {
}

// Set the main class for the application plugin
application {
    mainClass = 'irc.Irc'
}

// Configure the run task with proper JVM arguments for RMI
run {
    jvmArgs = [
        '-Djava.security.policy=all.policy',
        '-Djava.rmi.server.codebase=file://' + projectDir.absolutePath + '/build/classes/java/main/'
    ]
}

// Create a simple security policy file if it doesn't exist
tasks.register('createSecurityPolicy') {
    doLast {
        def policyFile = file('all.policy')
        if (!policyFile.exists()) {
            policyFile.text = '''grant {
    permission java.security.AllPermission;
};'''
        }
    }
}

// Ensure security policy is created before running
run.dependsOn createSecurityPolicy
compileJava.dependsOn createSecurityPolicy